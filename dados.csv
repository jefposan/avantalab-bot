# === CSV CONFIG ===
CSV_FILE = "dados.csv"

def ensure_csv():
    # cria um CSV NOVO com cabe√ßalho completo (UTF-8 c/ BOM p/ Excel)
    if not os.path.exists(CSV_FILE):
        with open(CSV_FILE, "w", newline="", encoding="utf-8-sig") as f:
            w = csv.writer(f, delimiter=",")
            w.writerow([
                "timestamp_utc","user_id","username","nome_apostador",
                "d1","d2","d3","d4","d5","d6","d7","d8","d9","d10"
            ])

def salvar_csv(user_id: int, username: str, nome_apostador: str, dezenas_fmt: str):
    ensure_csv()

    # extrai e normaliza 10 dezenas
    numeros = re.findall(r"\d{1,2}", dezenas_fmt)
    dezenas = [int(n) for n in numeros if 1 <= int(n) <= 60][:10]
    dezenas.sort()
    while len(dezenas) < 10:
        dezenas.append("")

    dcols = [f"{d:02d}" if d != "" else "" for d in dezenas]

    row = [datetime.utcnow().isoformat(), user_id, username, nome_apostador] + dcols

    with open(CSV_FILE, "a", newline="", encoding="utf-8-sig") as f:
        w = csv.writer(f, delimiter=",")
        w.writerow(row)
